-- Hourly aggregation of quest data

select @Datetime := concat(date(now() - interval 1440 minute),' ', SEC_TO_TIME((TIME_TO_SEC(time(now() - interval 1440 minute)) DIV 86400) * 86400));

INSERT INTO pogodb.stats_area_quest (Datetime,RPL, Area, Fence, stops, AR, nonAR)
select
@Datetime,
'1440',
Area,
Fence,
avg(stops),
sum(AR),
sum(nonAR)

from pogodb.stats_area_quest
where Datetime like concat(left(@Datetime,10),'%') and RPL = 60
group by Area,Fence
;
