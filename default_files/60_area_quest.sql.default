-- Hourly aggregation of quest data

select @Datetime := concat(date(now() - interval 60 minute),' ', SEC_TO_TIME((TIME_TO_SEC(time(now() - interval 60 minute)) DIV 3600) * 3600));


INSERT INTO pogodb.stats_area_quest (Datetime,RPL, Worker, Area, Fence, stops, AR, nonAR)
select
@Datetime,
'60',
Area,
Fence,
avg(stops),
sum(AR),
sum(nonAR)

from pogodb.stats_area_quest
where Datetime like concat(left(@Datetime,13),'%') and RPL = 15
group by Area,Fence
;
